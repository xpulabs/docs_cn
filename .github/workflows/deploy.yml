name: Deploy mdbooks

on:
  push:
    branches: [ main ]  # 或你用的主分支名

# 核心新增：配置 GITHUB_TOKEN 权限（解决403错误）
permissions:
  contents: write  # 赋予写入仓库内容的权限，支持推送 gh-pages 分支

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install mdbook
        run: |
          curl -sSL https://github.com/rust-lang/mdBook/releases/download/v0.4.36/mdbook-v0.4.36-x86_64-unknown-linux-gnu.tar.gz | tar -xz
          echo "$PWD" >> $GITHUB_PATH

      - name: Build polos-wch
        run: cd polos-wch && mdbook build

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./docs
          # 如果你想用自定义域名，取消下一行注释
          cname: docs.xpulabs.com